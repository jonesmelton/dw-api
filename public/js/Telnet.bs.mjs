// Generated by ReScript, PLEASE EDIT WITH CARE

import * as Js_array from "rescript/lib/es6/js_array.js";
import * as Belt_Array from "rescript/lib/es6/belt_Array.js";
import * as Belt_Option from "rescript/lib/es6/belt_Option.js";

function teloptFromInt(opt) {
  if (opt >= 240) {
    if (opt !== 250) {
      if (opt !== 255) {
        if (opt >= 241) {
          return /* OTHER */{
                  _0: opt
                };
        } else {
          return /* SE */2;
        }
      } else {
        return /* IAC */0;
      }
    } else {
      return /* SB */1;
    }
  } else if (opt !== 0) {
    if (opt !== 201) {
      return /* OTHER */{
              _0: opt
            };
    } else {
      return /* GMCP */3;
    }
  } else {
    return /* None */4;
  }
}

function stringFromTelopt(opt) {
  if (typeof opt !== "number") {
    return String.fromCharCode(opt._0);
  }
  switch (opt) {
    case /* IAC */0 :
        return " IAC ";
    case /* SB */1 :
        return " SB ";
    case /* SE */2 :
        return " SE ";
    case /* GMCP */3 :
        return " GMCP ";
    case /* None */4 :
        return "";
    
  }
}

function teloptToString(code) {
  return stringFromTelopt(teloptFromInt(code));
}

function run(_chars, _start, _end, _acc) {
  while(true) {
    var acc = _acc;
    var end = _end;
    var start = _start;
    var chars = _chars;
    var current = Belt_Option.getWithDefault(Belt_Option.map(Belt_Array.get(chars, start), teloptFromInt), /* None */4);
    var next = Belt_Option.getWithDefault(Belt_Option.map(Belt_Array.get(chars, start + 1 | 0), teloptFromInt), /* None */4);
    var nextnext = Belt_Option.getWithDefault(Belt_Option.map(Belt_Array.get(chars, start + 2 | 0), teloptFromInt), /* None */4);
    console.log(chars, start, end, acc);
    if (typeof current === "number") {
      if (current !== 0) {
        if (current >= 4) {
          return acc;
        }
        
      } else if (next === 1 && nextnext === 3) {
        var beginGMCP = start + 3 | 0;
        var nextSE = Belt_Option.getWithDefault(Belt_Array.getIndexBy(chars, (function (ele) {
                    return teloptFromInt(ele) === /* SE */2;
                  })), end - 1 | 0);
        var gmcp = Js_array.slice(beginGMCP, nextSE - 1 | 0, chars);
        var rest = Belt_Array.sliceToEnd(chars, nextSE);
        Js_array.push(/* Gmcp */{
              _0: gmcp
            }, acc.data);
        _end = rest.length - 1 | 0;
        _start = 0;
        _chars = rest;
        continue ;
      }
      
    }
    _acc = {
      text: acc.text + stringFromTelopt(current),
      data: acc.data
    };
    _end = chars.length - 1 | 0;
    _start = start + 1 | 0;
    continue ;
  };
}

function parse(chars) {
  return chars;
}

export {
  teloptFromInt ,
  stringFromTelopt ,
  teloptToString ,
  run ,
  parse ,
}
/* No side effect */
